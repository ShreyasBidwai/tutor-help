{% extends "base.html" %}

{% block title %}Homework - Tutor Help{% endblock %}

{% block header_title %}Homework{% endblock %}

{% block content %}
<div style="margin-bottom: 1rem;">
    <a href="{{ url_for('share_homework') }}" class="btn btn-primary btn-block">
        + Share New Homework
    </a>
</div>

{% if homework_list %}
    {% for hw in homework_list %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ hw.title }}</h3>
            <div style="display: flex; gap: 0.5rem;">
                <a href="{{ url_for('edit_homework', homework_id=hw.id) }}" class="btn btn-secondary btn-sm">
                    Edit
                </a>
                <button onclick="deleteHomework({{ hw.id }})" class="btn btn-danger btn-sm">
                    Delete
                </button>
            </div>
        </div>
        {% if hw.content %}
        <p style="margin-bottom: 1rem; color: #666;">{{ hw.content }}</p>
        {% endif %}
        {% if hw.file_path %}
        <div style="margin-bottom: 1rem;">
            <a href="{{ url_for('uploaded_file', filename=hw.file_path) }}" target="_blank" class="btn btn-secondary btn-sm" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                üìé View Document
            </a>
            {% if hw.file_path.lower().endswith(('.png', '.jpg', '.jpeg', '.gif')) %}
            <div style="margin-top: 0.75rem;">
                <img src="{{ url_for('uploaded_file', filename=hw.file_path) }}" alt="Homework document" style="max-width: 100%; border-radius: 8px;">
            </div>
            {% endif %}
        </div>
        {% endif %}
        {% if hw.youtube_url %}
        <div style="margin-bottom: 1rem;">
            {% set video_id = '' %}
            {% if 'v=' in hw.youtube_url %}
                {% set video_id = hw.youtube_url.split('v=')[-1].split('&')[0] %}
            {% elif 'youtu.be/' in hw.youtube_url %}
                {% set video_id = hw.youtube_url.split('youtu.be/')[-1].split('?')[0] %}
            {% elif 'embed/' in hw.youtube_url %}
                {% set video_id = hw.youtube_url.split('embed/')[-1].split('?')[0] %}
            {% else %}
                {% set video_id = hw.youtube_url.split('/')[-1] %}
            {% endif %}
            {% if video_id %}
            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;">
                <iframe 
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" 
                    src="https://www.youtube.com/embed/{{ video_id }}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            {% else %}
            <a href="{{ hw.youtube_url }}" target="_blank" class="btn btn-secondary btn-sm">
                üì∫ Watch Video
            </a>
            {% endif %}
        </div>
        {% endif %}
        <div style="margin-bottom: 1rem; font-size: 0.875rem; color: #666;">
            {% if hw.batch_name %}
            üìö Batch: {{ hw.batch_name }}
            {% elif hw.student_name %}
            üë§ Student: {{ hw.student_name }}
            {% endif %}
        </div>
        <a 
            href="https://wa.me/?text={{ hw.title|urlencode }}%20-%20{{ hw.content|urlencode }}{% if hw.file_path %}%20Document:%20{{ request.url_root }}uploads/{{ hw.file_path|urlencode }}{% endif %}{% if hw.youtube_url %}%20Video:%20{{ hw.youtube_url|urlencode }}{% endif %}" 
            target="_blank"
            class="btn btn-success btn-block"
        >
            üì± Share via WhatsApp
        </a>
    </div>
    {% endfor %}
{% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <h3>No homework shared yet</h3>
        <p>Share homework with your students</p>
        <a href="{{ url_for('share_homework') }}" class="btn btn-primary mt-2">
            Share Homework
        </a>
    </div>
{% endif %}

<script>
async function deleteHomework(homeworkId) {
    if (!confirm('Are you sure you want to delete this homework?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/homework/${homeworkId}`, {
            method: 'DELETE'
        });
        
        if (response.ok) {
            location.reload();
        } else {
            alert('Failed to delete homework');
        }
    } catch (error) {
        alert('Error deleting homework');
    }
}
</script>
{% endblock %}

